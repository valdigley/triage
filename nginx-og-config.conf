# Configuração Nginx para Open Graph em SPA
# Adicione este bloco ao seu arquivo de configuração do Nginx na VPS

# Proxy reverso para Edge Function do Supabase quando for bot
location ~ ^/g/(.+)$ {
    set $token $1;
    set $is_bot 0;

    # Detectar bots (WhatsApp, Facebook, Twitter, etc.)
    if ($http_user_agent ~* "(WhatsApp|facebookexternalhit|Twitterbot|LinkedInBot|Slackbot|TelegramBot)") {
        set $is_bot 1;
    }

    # Se for bot, fazer proxy para Edge Function do Supabase
    if ($is_bot = 1) {
        proxy_pass https://0ec90b57d6e95fcbda19832f.supabase.co/functions/v1/gallery-og-image?token=$token;
        proxy_set_header Host 0ec90b57d6e95fcbda19832f.supabase.co;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_ssl_server_name on;
        break;
    }

    # Se for usuário normal, redirecionar para /gallery/:token
    return 302 /gallery/$token;
}

# Rota normal para galeria (SPA)
location /gallery {
    try_files $uri $uri/ /index.html;
}
